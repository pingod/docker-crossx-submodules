name: Docker Image CI (master)[openvpn-fss]

on: [push]

jobs:

  build:

    runs-on: ubuntu-latest

    steps:
    - name: Fix up git URLs
      run: echo -e '[url "https://github.com/"]\n  insteadOf = "git@github.com:"' >> ~/.gitconfig
    - uses: chris-short/github-action-git-submodules@v0.1.0
      with:
        ref: master
        token: ${{ secrets.REPO_SCOPED_TOKEN }}
        submodules: true
    - name: Build the Docker image
      run: cd ./submodules && chmod +x ./build.sh && ./build.sh build v0.4


    # - name: Publish to Registry
    # - uses: azure/docker-login@master
    #   with:
    #     login-server: registry.cn-hangzhou.aliyuncs.com
    #     username: ${{ secrets.DOCKER_USERNAME }}
    #     password: ${{ secrets.DOCKER_PASSWORD }}
    #   run: cd ./submodules && chmod +x ./build.sh && ./build.sh release